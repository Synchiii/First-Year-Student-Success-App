<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forgot Password</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f4f7f6;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .card {
      width: 400px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>

  <div class="card p-4">
    <h3 class="text-center mb-3">Forgot Password</h3>

    <!-- Step 1: Enter Email -->
    <div id="emailStep">
      <p>Enter your registered email address to receive an OTP.</p>
      <input type="email" id="email" class="form-control mb-3" placeholder="Enter your email" required>
      <button class="btn btn-primary w-100" onclick="sendOTP()">Send OTP</button>
      <button class="btn btn-outline-secondary w-100 mt-2" onclick="goBack()">Back to Login</button>
    </div>

    <!-- Step 2: Enter OTP -->
    <div id="otpStep" class="hidden">
      <p>Weâ€™ve sent an OTP to your email. Enter it below to verify.</p>
      <input type="text" id="otp" class="form-control mb-3" placeholder="Enter OTP">
      <button class="btn btn-success w-100" onclick="verifyOTP()">Verify OTP</button>
      <button class="btn btn-outline-secondary w-100 mt-2" onclick="goBack()">Back to Login</button>
    </div>

    <!-- Step 3: New Password -->
    <div id="resetStep" class="hidden">
      <p>Enter your new password below.</p>
      <input type="password" id="newPassword" class="form-control mb-3" placeholder="New Password">
      <button class="btn btn-warning w-100" onclick="resetPassword()">Reset Password</button>
      <button class="btn btn-outline-secondary w-100 mt-2" onclick="goBack()">Back to Login</button>
    </div>
  </div>

  <!-- Bootstrap & EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

  <script>
    // Initialize EmailJS (replace with your own public key)
    (function(){
      emailjs.init("YOUR_PUBLIC_KEY_HERE");
    })();

    let generatedOTP = "";

    function sendOTP() {
      const email = document.getElementById("email").value;
      if (!email) {
        alert("Please enter your email address.");
        return;
      }

      // Generate random 6-digit OTP
      generatedOTP = Math.floor(100000 + Math.random() * 900000).toString();

      // EmailJS parameters
      const params = {
        to_email: email,
        otp: generatedOTP
      };

      emailjs.send("YOUR_SERVICE_ID", "YOUR_TEMPLATE_ID", params)
        .then(() => {
          alert("OTP sent to your email!");
          document.getElementById("emailStep").classList.add("hidden");
          document.getElementById("otpStep").classList.remove("hidden");
        })
        .catch((error) => {
          alert("Error sending email: " + JSON.stringify(error));
        });
    }

    function verifyOTP() {
      const userOTP = document.getElementById("otp").value;
      if (userOTP === generatedOTP) {
        alert("OTP verified successfully!");
        document.getElementById("otpStep").classList.add("hidden");
        document.getElementById("resetStep").classList.remove("hidden");
      } else {
        alert("Invalid OTP. Please try again.");
      }
    }

    function resetPassword() {
      const newPassword = document.getElementById("newPassword").value;
      if (!newPassword) {
        alert("Please enter a new password.");
        return;
      }
      alert("Your password has been reset successfully!");
      window.location.href = "Login.html"; // redirect to login
    }

    function goBack() {
      window.location.href = "Login.html";
    }
  </script>
</body>
</html>
